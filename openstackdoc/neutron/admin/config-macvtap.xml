<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/neutron/doc/source/admin/config-macvtap.rst">
    <target refid="config-macvtap"></target>
    <section ids="macvtap-mechanism-driver config-macvtap" names="macvtap\ mechanism\ driver config-macvtap">
        <title>Macvtap mechanism driver</title>
        <paragraph>The Macvtap mechanism driver for the ML2 plug-in generally increases
            network performance of instances.</paragraph>
        <paragraph>Consider the following attributes of this mechanism driver to determine
            practicality in your environment:</paragraph>
        <bullet_list bullet="*">
            <list_item>
                <paragraph>Supports only instance ports. Ports for DHCP and layer-3 (routing)
                    services must use another mechanism driver such as Linux bridge or
                    Open vSwitch (OVS).</paragraph>
            </list_item>
            <list_item>
                <paragraph>Supports only untagged (flat) and tagged (VLAN) networks.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Lacks support for security groups including basic (sanity) and
                    anti-spoofing rules.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Lacks support for layer-3 high-availability mechanisms such as
                    Virtual Router Redundancy Protocol (VRRP) and Distributed Virtual
                    Routing (DVR).</paragraph>
            </list_item>
            <list_item>
                <paragraph>Only compute resources can be attached via macvtap. Attaching other
                    resources like DHCP, Routers and others is not supported. Therefore run
                    either OVS or linux bridge in VLAN or flat mode on the controller node.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Instance migration requires the same values for the
                    <literal>physical_interface_mapping</literal> configuration option on each compute node.
                    For more information, see
                    <reference name="https://bugs.launchpad.net/neutron/+bug/1550400" refuri="https://bugs.launchpad.net/neutron/+bug/1550400">https://bugs.launchpad.net/neutron/+bug/1550400</reference><target ids="https-bugs-launchpad-net-neutron-bug-1550400" names="https://bugs.launchpad.net/neutron/+bug/1550400" refuri="https://bugs.launchpad.net/neutron/+bug/1550400"></target>.</paragraph>
            </list_item>
        </bullet_list>
        <section ids="prerequisites" names="prerequisites">
            <title>Prerequisites</title>
            <paragraph>You can add this mechanism driver to an existing environment using either
                the Linux bridge or OVS mechanism drivers with only provider networks or
                provider and self-service networks. You can change the configuration of
                existing compute nodes or add compute nodes with the Macvtap mechanism
                driver. The example configuration assumes addition of compute nodes with
                the Macvtap mechanism driver to the <reference internal="True" refuri="deploy-lb-selfservice#deploy-lb-selfservice"><inline classes="std std-ref">Linux bridge: Self-service networks</inline></reference> or
                <reference internal="True" refuri="deploy-ovs-selfservice#deploy-ovs-selfservice"><inline classes="std std-ref">Open vSwitch: Self-service networks</inline></reference> deployment examples.</paragraph>
            <paragraph>Add one or more compute nodes with the following components:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Three network interfaces: management, provider, and overlay.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>OpenStack Networking Macvtap layer-2 agent and any dependencies.</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>To support integration with the deployment examples, this content
                    configures the Macvtap mechanism driver to use the overlay network
                    for untagged (flat) or tagged (VLAN) networks in addition to overlay
                    networks such as VXLAN. Your physical network infrastructure
                    must support VLAN (802.1q) tagging on the overlay network.</paragraph>
            </note>
        </section>
        <section ids="architecture" names="architecture">
            <title>Architecture</title>
            <paragraph>The Macvtap mechanism driver only applies to compute nodes. Otherwise,
                the environment resembles the prerequisite deployment example.</paragraph>
            <image alt="Macvtap mechanism driver - compute node components" candidates="{'*': 'admin/figures/config-macvtap-compute1.png'}" uri="admin/figures/config-macvtap-compute1.png"></image>
            <image alt="Macvtap mechanism driver - compute node connectivity" candidates="{'*': 'admin/figures/config-macvtap-compute2.png'}" uri="admin/figures/config-macvtap-compute2.png"></image>
        </section>
        <section ids="example-configuration" names="example\ configuration">
            <title>Example configuration</title>
            <paragraph>Use the following example configuration as a template to add support for
                the Macvtap mechanism driver to an existing operational environment.</paragraph>
            <section ids="controller-node" names="controller\ node">
                <title>Controller node</title>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>In the <literal>ml2_conf.ini</literal> file:</paragraph>
                        <bullet_list bullet="*">
                            <list_item>
                                <paragraph>Add <literal>macvtap</literal> to mechanism drivers.</paragraph>
                                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2]
mechanism_drivers = macvtap</literal_block>
                            </list_item>
                            <list_item>
                                <paragraph>Configure network mappings.</paragraph>
                                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2_type_flat]
flat_networks = provider,macvtap

[ml2_type_vlan]
network_vlan_ranges = provider,macvtap:VLAN_ID_START:VLAN_ID_END</literal_block>
                                <note>
                                    <paragraph>Use of <literal>macvtap</literal> is arbitrary. Only the self-service deployment
                                        examples require VLAN ID ranges. Replace <literal>VLAN_ID_START</literal> and
                                        <literal>VLAN_ID_END</literal> with appropriate numerical values.</paragraph>
                                </note>
                            </list_item>
                        </bullet_list>
                    </list_item>
                    <list_item>
                        <paragraph>Restart the following services:</paragraph>
                        <bullet_list bullet="*">
                            <list_item>
                                <paragraph>Server</paragraph>
                            </list_item>
                        </bullet_list>
                    </list_item>
                </enumerated_list>
            </section>
            <section ids="network-nodes" names="network\ nodes">
                <title>Network nodes</title>
                <paragraph>No changes.</paragraph>
            </section>
            <section ids="compute-nodes" names="compute\ nodes">
                <title>Compute nodes</title>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Install the Networking service Macvtap layer-2 agent.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>In the <literal>neutron.conf</literal> file, configure common options:</paragraph>
                        <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
core_plugin = ml2
auth_strategy = keystone

[database]
# ...

[keystone_authtoken]
# ...

[nova]
# ...

[agent]
# ...</literal_block>
                        <paragraph>See the <reference name="Installation Tutorials and Guides" refuri="https://docs.openstack.org">Installation Tutorials and Guides</reference><target ids="installation-tutorials-and-guides" names="installation\ tutorials\ and\ guides" refuri="https://docs.openstack.org"></target> and
                            <reference name="Configuration Reference" refuri="https://docs.openstack.org">Configuration Reference</reference><target ids="configuration-reference" names="configuration\ reference" refuri="https://docs.openstack.org"></target> for your OpenStack
                            release to obtain the appropriate additional configuration for the
                            <literal>[DEFAULT]</literal>, <literal>[database]</literal>, <literal>[keystone_authtoken]</literal>, <literal>[nova]</literal>, and
                            <literal>[agent]</literal> sections.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>In the <literal>macvtap_agent.ini</literal> file, configure the layer-2 agent.</paragraph>
                        <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[macvtap]
physical_interface_mappings = macvtap:MACVTAP_INTERFACE

[securitygroup]
firewall_driver = noop</literal_block>
                        <paragraph>Replace <literal>MACVTAP_INTERFACE</literal> with the name of the underlying
                            interface that handles Macvtap mechanism driver interfaces.
                            If using a prerequisite deployment example, replace
                            <literal>MACVTAP_INTERFACE</literal> with the name of the underlying interface
                            that handles overlay networks. For example, <literal>eth1</literal>.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Start the following services:</paragraph>
                        <bullet_list bullet="*">
                            <list_item>
                                <paragraph>Macvtap agent</paragraph>
                            </list_item>
                        </bullet_list>
                    </list_item>
                </enumerated_list>
            </section>
            <section ids="verify-service-operation" names="verify\ service\ operation">
                <title>Verify service operation</title>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Source the administrative project credentials.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Verify presence and operation of the agents:</paragraph>
                        <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack network agent list
+--------------------------------------+--------------------+----------+-------------------+-------+-------+---------------------------+
| ID                                   | Agent Type         | Host     | Availability Zone | Alive | State | Binary                    |
+--------------------------------------+--------------------+----------+-------------------+-------+-------+---------------------------+
| 31e1bc1b-c872-4429-8fc3-2c8eba52634e | Metadata agent     | compute1 | None              | True  | UP    | neutron-metadata-agent    |
| 378f5550-feee-42aa-a1cb-e548b7c2601f | Open vSwitch agent | compute1 | None              | True  | UP    | neutron-openvswitch-agent |
| 7d2577d0-e640-42a3-b303-cb1eb077f2b6 | L3 agent           | compute1 | nova              | True  | UP    | neutron-l3-agent          |
| d5d7522c-ad14-4c63-ab45-f6420d6a81dd | Metering agent     | compute1 | None              | True  | UP    | neutron-metering-agent    |
| e838ef5c-75b1-4b12-84da-7bdbd62f1040 | DHCP agent         | compute1 | nova              | True  | UP    | neutron-dhcp-agent        |
+--------------------------------------+--------------------+----------+-------------------+-------+-------+---------------------------+</literal_block>
                    </list_item>
                </enumerated_list>
            </section>
            <section ids="create-initial-networks" names="create\ initial\ networks">
                <title>Create initial networks</title>
                <paragraph>This mechanism driver simply changes the virtual network interface driver
                    for instances. Thus, you can reference the <literal>Create initial networks</literal>
                    content for the prerequisite deployment example.</paragraph>
            </section>
            <section ids="verify-network-operation" names="verify\ network\ operation">
                <title>Verify network operation</title>
                <paragraph>This mechanism driver simply changes the virtual network interface driver
                    for instances. Thus, you can reference the <literal>Verify network operation</literal>
                    content for the prerequisite deployment example.</paragraph>
            </section>
        </section>
        <section ids="network-traffic-flow" names="network\ traffic\ flow">
            <title>Network traffic flow</title>
            <paragraph>This mechanism driver simply removes the Linux bridge handling security
                groups on the compute nodes. Thus, you can reference the network traffic
                flow scenarios for the prerequisite deployment example.</paragraph>
        </section>
    </section>
</document>
