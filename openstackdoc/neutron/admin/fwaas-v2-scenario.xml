<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/neutron/doc/source/admin/fwaas-v2-scenario.rst">
    <section ids="firewall-as-a-service-fwaas-v2-scenario" names="firewall-as-a-service\ (fwaas)\ v2\ scenario">
        <title>Firewall-as-a-Service (FWaaS) v2 scenario</title>
        <section ids="enable-fwaas-v2" names="enable\ fwaas\ v2">
            <title>Enable FWaaS v2</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Enable the FWaaS plug-in in the <literal>/etc/neutron/neutron.conf</literal> file:</paragraph>
                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">service_plugins = firewall_v2

[service_providers]
# ...
service_provider = FIREWALL:Iptables:neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver:default

[fwaas]
agent_version = v2
driver = neutron_fwaas.services.firewall.drivers.linux.iptables_fwaas_v2.IptablesFwaasDriver
enabled = True</literal_block>
                    <note>
                        <paragraph>On Ubuntu and Centos, modify the <literal>[fwaas]</literal> section in the
                            <literal>/etc/neutron/fwaas_driver.ini</literal> file instead of
                            <literal>/etc/neutron/neutron.conf</literal>.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Configure the FWaaS plugin for the L3 agent.</paragraph>
                    <paragraph>In the <literal>AGENT</literal> section of <literal>l3_agent.ini</literal>, make sure the FWaaS extension
                        is loaded:</paragraph>
                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[AGENT]
extensions = fwaas</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create the required tables in the database:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># neutron-db-manage --subproject neutron-fwaas upgrade head</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Restart the <literal>neutron-l3-agent</literal> and <literal>neutron-server</literal> services
                        to apply the settings.</paragraph>
                    <note>
                        <paragraph>Firewall v2 is not supported by horizon yet.</paragraph>
                    </note>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="configure-firewall-as-a-service-v2" names="configure\ firewall-as-a-service\ v2">
            <title>Configure Firewall-as-a-Service v2</title>
            <paragraph>Create the firewall rules and create a policy that contains them.
                Then, create a firewall that applies the policy.</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Create a firewall rule:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ neutron firewall-rule-create --protocol {tcp,udp,icmp,any} \
  --source-ip-address SOURCE_IP_ADDRESS \
  --destination-ip-address DESTINATION_IP_ADDRESS \
  --source-port SOURCE_PORT_RANGE --destination-port DEST_PORT_RANGE \
  --action {allow,deny,reject}</literal_block>
                    <paragraph>The Networking client requires a protocol value.  If the rule is protocol
                        agnostic, you can use the <literal>any</literal> value.</paragraph>
                    <note>
                        <paragraph>When the source or destination IP address are not of the same IP
                            version (for example, IPv6), the command returns an error.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Create a firewall policy:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ neutron firewall-policy-create --firewall-rules \
  "FIREWALL_RULE_IDS_OR_NAMES" myfirewallpolicy</literal_block>
                    <paragraph>Separate firewall rule IDs or names with spaces. The order in which you
                        specify the rules is important.</paragraph>
                    <paragraph>You can create a firewall policy without any rules and add rules later,
                        as follows:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>To add multiple rules, use the update operation.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>To add a single rule, use the insert-rule operation.</paragraph>
                        </list_item>
                    </bullet_list>
                    <paragraph>For more details, see <reference name="Networking command-line client" refuri="https://docs.openstack.org/cli-reference/neutron.html">Networking command-line client</reference><target ids="networking-command-line-client" names="networking\ command-line\ client" refuri="https://docs.openstack.org/cli-reference/neutron.html"></target>
                        in the OpenStack Command-Line Interface Reference.</paragraph>
                    <note>
                        <paragraph>FWaaS always adds a default <literal>deny all</literal> rule at the lowest precedence
                            of each policy. Consequently, a firewall policy with no rules blocks
                            all traffic by default.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Create a firewall:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ neutron firewall-create FIREWALL_POLICY_UUID</literal_block>
                    <note>
                        <paragraph>The firewall remains in PENDING_CREATE state until you create a
                            Networking router and attach an interface to it.</paragraph>
                    </note>
                </list_item>
            </enumerated_list>
        </section>
    </section>
</document>
