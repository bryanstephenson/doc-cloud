<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/neutron/doc/source/admin/migration-classic-to-l3ha.rst">
    <target refid="migration-to-vrrp"></target>
    <section ids="add-vrrp-to-an-existing-router migration-to-vrrp" names="add\ vrrp\ to\ an\ existing\ router migration-to-vrrp">
        <title>Add VRRP to an existing router</title>
        <paragraph>This section describes the process of migrating from a classic router to an L3
            HA router, which is available starting from the Mitaka release.</paragraph>
        <paragraph>Similar to the classic scenario, all network traffic on a project network that
            requires routing actively traverses only one network node regardless of the
            quantity of network nodes providing HA for the router. Therefore, this
            high-availability implementation primarily addresses failure situations instead
            of bandwidth constraints that limit performance. However, it supports random
            distribution of routers on different network nodes to reduce the chances of
            bandwidth constraints and to improve scaling.</paragraph>
        <paragraph>This section references parts of <reference internal="True" refuri="deploy-lb-ha-vrrp#deploy-lb-ha-vrrp"><inline classes="std std-ref">Linux bridge: High availability using VRRP</inline></reference> and
            <reference internal="True" refuri="deploy-ovs-ha-vrrp#deploy-ovs-ha-vrrp"><inline classes="std std-ref">Open vSwitch: High availability using VRRP</inline></reference>. For details regarding needed infrastructure and
            configuration to allow actual L3 HA deployment, read the relevant guide
            before continuing with the migration process.</paragraph>
        <section ids="migration" names="migration">
            <title>Migration</title>
            <paragraph>The migration process is quite simple, it involves turning down the router by
                setting the router’s <literal>admin_state_up</literal> attribute to <literal>False</literal>, upgrading the
                router to L3 HA and then setting the router’s <literal>admin_state_up</literal> attribute back
                to <literal>True</literal>.</paragraph>
            <warning>
                <paragraph>Once starting the migration, south-north connections (instances to internet)
                    will be severed. New connections will be able to start only when the
                    migration is complete.</paragraph>
            </warning>
            <paragraph>Here is the router we have used in our demonstration:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack router show router1
+-------------------------+-------------------------------------------+
| Field                   | Value                                     |
+-------------------------+-------------------------------------------+
| admin_state_up          | UP                                        |
| distributed             | False                                     |
| external_gateway_info   |                                           |
| ha                      | False                                     |
| id                      | 6b793b46-d082-4fd5-980f-a6f80cbb0f2a      |
| name                    | router1                                   |
| project_id              | bb8b84ab75be4e19bd0dfe02f6c3f5c1          |
| routes                  |                                           |
| status                  | ACTIVE                                    |
+-------------------------+-------------------------------------------+</literal_block>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Source the administrative project credentials.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Set the admin_state_up to <literal>False</literal>. This will severe south-north
                        connections until admin_state_up is set to <literal>True</literal> again.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack router set router1 --disable</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Set the <literal>ha</literal> attribute of the router to <literal>True</literal>.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack router set router1 --ha</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Set the admin_state_up to <literal>True</literal>.
                        After this, south-north connections can start.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack router set router1 --enable</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Make sure that the router’s <literal>ha</literal> attribute has changed to <literal>True</literal>.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack router show router1
+-------------------------+-------------------------------------------+
| Field                   | Value                                     |
+-------------------------+-------------------------------------------+
| admin_state_up          | UP                                        |
| distributed             | False                                     |
| external_gateway_info   |                                           |
| ha                      | True                                      |
| id                      | 6b793b46-d082-4fd5-980f-a6f80cbb0f2a      |
| name                    | router1                                   |
| project_id              | bb8b84ab75be4e19bd0dfe02f6c3f5c1          |
| routes                  |                                           |
| status                  | ACTIVE                                    |
+-------------------------+-------------------------------------------+</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="l3-ha-to-legacy" names="l3\ ha\ to\ legacy">
            <title>L3 HA to Legacy</title>
            <paragraph>To return to classic mode, turn down the router again, turning off L3 HA
                and starting the router again.</paragraph>
            <warning>
                <paragraph>Once starting the migration, south-north connections (instances to internet)
                    will be severed. New connections will be able to start only when the
                    migration is complete.</paragraph>
            </warning>
            <paragraph>Here is the router we have used in our demonstration:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack router show router1
+-------------------------+-------------------------------------------+
| Field                   | Value                                     |
+-------------------------+-------------------------------------------+
| admin_state_up          | DOWN                                      |
| distributed             | False                                     |
| external_gateway_info   |                                           |
| ha                      | True                                      |
| id                      | 6b793b46-d082-4fd5-980f-a6f80cbb0f2a      |
| name                    | router1                                   |
| project_id              | bb8b84ab75be4e19bd0dfe02f6c3f5c1          |
| routes                  |                                           |
| status                  | ACTIVE                                    |
+-------------------------+-------------------------------------------+</literal_block>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Source the administrative project credentials.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Set the admin_state_up to <literal>False</literal>. This will severe south-north
                        connections until admin_state_up is set to <literal>True</literal> again.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack router set router1 --disable</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Set the <literal>ha</literal> attribute of the router to <literal>True</literal>.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack router set router1 --no-ha</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Set the admin_state_up to <literal>True</literal>.
                        After this, south-north connections can start.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack router set router1 --enable</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Make sure that the router’s <literal>ha</literal> attribute has changed to <literal>False</literal>.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack router show router1
+-------------------------+-------------------------------------------+
| Field                   | Value                                     |
+-------------------------+-------------------------------------------+
| admin_state_up          | UP                                        |
| distributed             | False                                     |
| external_gateway_info   |                                           |
| ha                      | False                                     |
| id                      | 6b793b46-d082-4fd5-980f-a6f80cbb0f2a      |
| name                    | router1                                   |
| project_id              | bb8b84ab75be4e19bd0dfe02f6c3f5c1          |
| routes                  |                                           |
| status                  | ACTIVE                                    |
+-------------------------+-------------------------------------------+</literal_block>
                </list_item>
            </enumerated_list>
        </section>
    </section>
</document>
