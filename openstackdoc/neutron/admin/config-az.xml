<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/neutron/doc/source/admin/config-az.rst">
    <target refid="config-az"></target>
    <section ids="availability-zones config-az" names="availability\ zones config-az">
        <title>Availability zones</title>
        <paragraph>An availability zone groups network nodes that run services like DHCP, L3, FW,
            and others. It is defined as an agent’s attribute on the network node. This
            allows users to associate an availability zone with their resources so that the
            resources get high availability.</paragraph>
        <section ids="use-case" names="use\ case">
            <title>Use case</title>
            <paragraph>An availability zone is used to make network resources highly available. The
                operators group the nodes that are attached to different power sources under
                separate availability zones and configure scheduling for resources with high
                availability so that they are scheduled on different availability zones.</paragraph>
        </section>
        <section ids="required-extensions" names="required\ extensions">
            <title>Required extensions</title>
            <paragraph>The core plug-in must support the <literal>availability_zone</literal> extension. The core
                plug-in also must support the <literal>network_availability_zone</literal> extension to
                schedule a network according to availability zones. The <literal>Ml2Plugin</literal> supports
                it. The router service plug-in must support the <literal>router_availability_zone</literal>
                extension to schedule a router according to the availability zones. The
                <literal>L3RouterPlugin</literal> supports it.</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack extension list --network -c Alias -c Name
+---------------------------+---------------------------+
| Name                      | Alias                     |
+---------------------------+---------------------------+
...
| Network Availability Zone | network_availability_zone |
...
| Availability Zone         | availability_zone         |
...
| Router Availability Zone  | router_availability_zone  |
...
+---------------------------+---------------------------+</literal_block>
            <section ids="availability-zone-of-agents" names="availability\ zone\ of\ agents">
                <title>Availability zone of agents</title>
                <paragraph>The <literal>availability_zone</literal> attribute can be defined in <literal>dhcp-agent</literal> and
                    <literal>l3-agent</literal>. To define an availability zone for each agent, set the
                    value into <literal>[AGENT]</literal> section of <literal>/etc/neutron/dhcp_agent.ini</literal> or
                    <literal>/etc/neutron/l3_agent.ini</literal>:</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[AGENT]
availability_zone = zone-1</literal_block>
                <paragraph>To confirm the agent’s availability zone:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack network agent show 116cc128-4398-49af-a4ed-3e95494cd5fc
+---------------------+---------------------------------------------------+
| Field               | Value                                             |
+---------------------+---------------------------------------------------+
| admin_state_up      | UP                                                |
| agent_type          | DHCP agent                                        |
| alive               | True                                              |
| availability_zone   | zone-1                                            |
| binary              | neutron-dhcp-agent                                |
| configurations      | dhcp_driver='neutron.agent.linux.dhcp.Dnsmasq',   |
|                     | dhcp_lease_duration='86400',                      |
|                     | log_agent_heartbeats='False', networks='2',       |
|                     | notifies_port_ready='True', ports='6', subnets='4 |
| created_at          | 2016-12-14 00:25:54                               |
| description         | None                                              |
| heartbeat_timestamp | 2016-12-14 06:20:24                               |
| host                | ankur-desktop                                     |
| id                  | 116cc128-4398-49af-a4ed-3e95494cd5fc              |
| started_at          | 2016-12-14 00:25:54                               |
| topic               | dhcp_agent                                        |
+---------------------+---------------------------------------------------+

$ openstack network agent show 9632309a-2aa4-4304-8603-c4de02c4a55f
+---------------------+-------------------------------------------------+
| Field               | Value                                           |
+---------------------+-------------------------------------------------+
| admin_state_up      | UP                                              |
| agent_type          | L3 agent                                        |
| alive               | True                                            |
| availability_zone   | zone-1                                          |
| binary              | neutron-l3-agent                                |
| configurations      | agent_mode='legacy', ex_gw_ports='2',           |
|                     | external_network_bridge='', floating_ips='0',   |
|                     | gateway_external_network_id='',                 |
|                     | handle_internal_only_routers='True',            |
|                     | interface_driver='openvswitch', interfaces='4', |
|                     | log_agent_heartbeats='False', routers='2'       |
| created_at          | 2016-12-14 00:25:58                             |
| description         | None                                            |
| heartbeat_timestamp | 2016-12-14 06:20:28                             |
| host                | ankur-desktop                                   |
| id                  | 9632309a-2aa4-4304-8603-c4de02c4a55f            |
| started_at          | 2016-12-14 00:25:58                             |
| topic               | l3_agent                                        |
+---------------------+-------------------------------------------------+</literal_block>
            </section>
            <section ids="availability-zone-related-attributes" names="availability\ zone\ related\ attributes">
                <title>Availability zone related attributes</title>
                <paragraph>The following attributes are added into network and router:</paragraph>
                <table classes="colwidths-given">
                    <tgroup cols="5">
                        <colspec colwidth="25"></colspec>
                        <colspec colwidth="10"></colspec>
                        <colspec colwidth="10"></colspec>
                        <colspec colwidth="10"></colspec>
                        <colspec colwidth="50"></colspec>
                        <thead>
                            <row>
                                <entry>
                                    <paragraph>Attribute name</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>Access</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>Required</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>Input type</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>Description</paragraph>
                                </entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>
                                    <paragraph>availability_zone_hints</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>RW(POST only)</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>No</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>list of string</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>availability zone candidates for the resource</paragraph>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>availability_zones</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>RO</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>N/A</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>list of string</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>availability zones for the resource</paragraph>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <paragraph>Use <literal>availability_zone_hints</literal> to specify the zone in which the resource is
                    hosted:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack network create --availability-zone-hint zone-1 \
--availability-zone-hint zone-2 net1
+---------------------------+--------------------------------------+
| Field                     | Value                                |
+---------------------------+--------------------------------------+
| admin_state_up            | UP                                   |
| availability_zone_hints   | zone-1                               |
|                           | zone-2                               |
| availability_zones        |                                      |
| created_at                | 2016-12-14T06:23:36Z                 |
| description               |                                      |
| headers                   |                                      |
| id                        | ad88e059-e7fa-4cf7-8857-6731a2a3a554 |
| ipv4_address_scope        | None                                 |
| ipv6_address_scope        | None                                 |
| mtu                       | 1450                                 |
| name                      | net1                                 |
| port_security_enabled     | True                                 |
| project_id                | cfd1889ac7d64ad891d4f20aef9f8d7c     |
| provider:network_type     | vxlan                                |
| provider:physical_network | None                                 |
| provider:segmentation_id  | 77                                   |
| revision_number           | 3                                    |
| router:external           | Internal                             |
| shared                    | False                                |
| status                    | ACTIVE                               |
| subnets                   |                                      |
| tags                      | []                                   |
| updated_at                | 2016-12-14T06:23:37Z                 |
+---------------------------+--------------------------------------+</literal_block>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack router create --ha --availability-zone-hint zone-1 \
--availability-zone-hint zone-2 router1
+-------------------------+--------------------------------------+
| Field                   | Value                                |
+-------------------------+--------------------------------------+
| admin_state_up          | UP                                   |
| availability_zone_hints | zone-1                               |
|                         | zone-2                               |
| availability_zones      |                                      |
| created_at              | 2016-12-14T06:25:40Z                 |
| description             |                                      |
| distributed             | False                                |
| external_gateway_info   | null                                 |
| flavor_id               | None                                 |
| ha                      | False                                |
| headers                 |                                      |
| id                      | ced10262-6cfe-47c1-8847-cd64276a868c |
| name                    | router1                              |
| project_id              | cfd1889ac7d64ad891d4f20aef9f8d7c     |
| revision_number         | 3                                    |
| routes                  |                                      |
| status                  | ACTIVE                               |
| updated_at              | 2016-12-14T06:25:40Z                 |
+-------------------------+--------------------------------------+</literal_block>
                <paragraph>Availability zone is selected from <literal>default_availability_zones</literal> in
                    <literal>/etc/neutron/neutron.conf</literal> if a resource is created without
                    <literal>availability_zone_hints</literal>:</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">default_availability_zones = zone-1,zone-2</literal_block>
                <paragraph>To confirm the availability zone defined by the system:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack availability zone list
+-----------+-------------+
| Zone Name | Zone Status |
+-----------+-------------+
| zone-1    | available   |
| zone-2    | available   |
| zone-1    | available   |
| zone-2    | available   |
+-----------+-------------+</literal_block>
                <paragraph>Look at the <literal>availability_zones</literal> attribute of each resource to confirm in
                    which zone the resource is hosted:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack network show net1
+---------------------------+--------------------------------------+
| Field                     | Value                                |
+---------------------------+--------------------------------------+
| admin_state_up            | UP                                   |
| availability_zone_hints   | zone-1                               |
|                           | zone-2                               |
| availability_zones        | zone-1                               |
|                           | zone-2                               |
| created_at                | 2016-12-14T06:23:36Z                 |
| description               |                                      |
| headers                   |                                      |
| id                        | ad88e059-e7fa-4cf7-8857-6731a2a3a554 |
| ipv4_address_scope        | None                                 |
| ipv6_address_scope        | None                                 |
| mtu                       | 1450                                 |
| name                      | net1                                 |
| port_security_enabled     | True                                 |
| project_id                | cfd1889ac7d64ad891d4f20aef9f8d7c     |
| provider:network_type     | vxlan                                |
| provider:physical_network | None                                 |
| provider:segmentation_id  | 77                                   |
| revision_number           | 3                                    |
| router:external           | Internal                             |
| shared                    | False                                |
| status                    | ACTIVE                               |
| subnets                   |                                      |
| tags                      | []                                   |
| updated_at                | 2016-12-14T06:23:37Z                 |
+---------------------------+--------------------------------------+</literal_block>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack router show router1
+-------------------------+--------------------------------------+
| Field                   | Value                                |
+-------------------------+--------------------------------------+
| admin_state_up          | UP                                   |
| availability_zone_hints | zone-1                               |
|                         | zone-2                               |
| availability_zones      | zone-1                               |
|                         | zone-2                               |
| created_at              | 2016-12-14T06:25:40Z                 |
| description             |                                      |
| distributed             | False                                |
| external_gateway_info   | null                                 |
| flavor_id               | None                                 |
| ha                      | False                                |
| headers                 |                                      |
| id                      | ced10262-6cfe-47c1-8847-cd64276a868c |
| name                    | router1                              |
| project_id              | cfd1889ac7d64ad891d4f20aef9f8d7c     |
| revision_number         | 3                                    |
| routes                  |                                      |
| status                  | ACTIVE                               |
| updated_at              | 2016-12-14T06:25:40Z                 |
+-------------------------+--------------------------------------+</literal_block>
                <note>
                    <paragraph>The <literal>availability_zones</literal> attribute does not have a value until the
                        resource is scheduled. Once the Networking service schedules the resource
                        to zones according to <literal>availability_zone_hints</literal>, <literal>availability_zones</literal>
                        shows in which zone the resource is hosted practically. The
                        <literal>availability_zones</literal> may not match <literal>availability_zone_hints</literal>. For
                        example, even if you specify a zone with <literal>availability_zone_hints</literal>, all
                        agents of the zone may be dead before the resource is scheduled. In
                        general, they should match, unless there are failures or there is no
                        capacity left in the zone requested.</paragraph>
                </note>
            </section>
            <section ids="availability-zone-aware-scheduler" names="availability\ zone\ aware\ scheduler">
                <title>Availability zone aware scheduler</title>
            </section>
        </section>
        <section ids="network-scheduler" names="network\ scheduler">
            <title>Network scheduler</title>
            <paragraph>Set <literal>AZAwareWeightScheduler</literal> to <literal>network_scheduler_driver</literal> in
                <literal>/etc/neutron/neutron.conf</literal> so that the Networking service schedules a
                network according to the availability zone:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">network_scheduler_driver = neutron.scheduler.dhcp_agent_scheduler.AZAwareWeightScheduler
dhcp_load_type = networks</literal_block>
            <paragraph>The Networking service schedules a network to one of the agents within the
                selected zone as with <literal>WeightScheduler</literal>. In this case, scheduler refers to
                <literal>dhcp_load_type</literal> as well.</paragraph>
        </section>
        <section ids="router-scheduler" names="router\ scheduler">
            <title>Router scheduler</title>
            <paragraph>Set <literal>AZLeastRoutersScheduler</literal> to <literal>router_scheduler_driver</literal> in file
                <literal>/etc/neutron/neutron.conf</literal> so that the Networking service schedules a router
                according to the availability zone:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">router_scheduler_driver = neutron.scheduler.l3_agent_scheduler.AZLeastRoutersScheduler</literal_block>
            <paragraph>The Networking service schedules a router to one of the agents within the
                selected zone as with <literal>LeastRouterScheduler</literal>.</paragraph>
            <section ids="achieving-high-availability-with-availability-zone" names="achieving\ high\ availability\ with\ availability\ zone">
                <title>Achieving high availability with availability zone</title>
                <paragraph>Although, the Networking service provides high availability for routers and
                    high availability and fault tolerance for networks’ DHCP services, availability
                    zones provide an extra layer of protection by segmenting a Networking service
                    deployment in isolated failure domains. By deploying HA nodes across different
                    availability zones, it is guaranteed that network services remain available in
                    face of zone-wide failures that affect the deployment.</paragraph>
                <paragraph>This section explains how to get high availability with the availability zone
                    for L3 and DHCP. You should naturally set above configuration options for the
                    availability zone.</paragraph>
            </section>
        </section>
        <section ids="l3-high-availability" names="l3\ high\ availability">
            <title>L3 high availability</title>
            <paragraph>Set the following configuration options in file <literal>/etc/neutron/neutron.conf</literal>
                so that you get L3 high availability.</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">l3_ha = True
max_l3_agents_per_router = 3</literal_block>
            <paragraph>HA routers are created on availability zones you selected when creating the
                router.</paragraph>
        </section>
        <section ids="dhcp-high-availability" names="dhcp\ high\ availability">
            <title>DHCP high availability</title>
            <paragraph>Set the following configuration options in file <literal>/etc/neutron/neutron.conf</literal>
                so that you get DHCP high availability.</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">dhcp_agents_per_network = 2</literal_block>
            <paragraph>DHCP services are created on availability zones you selected when creating the
                network.</paragraph>
        </section>
    </section>
</document>
