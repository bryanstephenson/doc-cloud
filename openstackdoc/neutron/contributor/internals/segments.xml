<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/neutron/doc/source/contributor/internals/segments.rst">
    <comment xml:space="preserve">Licensed under the Apache License, Version 2.0 (the "License"); you may
not use this file except in compliance with the License. You may obtain
a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.</comment>
    <section ids="segments-extension" names="segments\ extension">
        <title>Segments extension</title>
        <paragraph>Neutron has an extension that allows CRUD operations on the <literal>/segments</literal>
            resource in the API, that corresponds to the <literal>NetworkSegment</literal> entity in the
            DB layer. The extension is implemented as a service plug-in.</paragraph>
        <note>
            <paragraph>The <literal>segments</literal> service plug-in is not configured by default. To
                configure it, add <literal>segments</literal> to the <literal>service_plugins</literal> parameter in
                <literal>neutron.conf</literal></paragraph>
        </note>
        <paragraph>Core plug-ins can coordinate with the <literal>segments</literal> service plug-in by
            subscribing callbacks to events associated to the <literal>SEGMENT</literal> resource.
            Currently, the segments plug-in notifies subscribers of the following events:</paragraph>
        <bullet_list bullet="*">
            <list_item>
                <paragraph><literal>PRECOMMIT_CREATE</literal></paragraph>
            </list_item>
            <list_item>
                <paragraph><literal>AFTER_CREATE</literal></paragraph>
            </list_item>
            <list_item>
                <paragraph><literal>BEFORE_DELETE</literal></paragraph>
            </list_item>
            <list_item>
                <paragraph><literal>PRECOMMIT_DELETE</literal></paragraph>
            </list_item>
            <list_item>
                <paragraph><literal>AFTER_DELETE</literal></paragraph>
            </list_item>
        </bullet_list>
        <paragraph>As of this writing, <literal>ML2</literal> and <literal>OVN</literal> register callbacks to receive events
            from the <literal>segments</literal> service plug-in. The <literal>ML2</literal> plug-in defines the
            callback <literal>_handle_segment_change</literal> to process all the relevant segments
            events.</paragraph>
        <section ids="segments-extension-relevant-modules" names="segments\ extension\ relevant\ modules">
            <title>Segments extension relevant modules</title>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph><literal>neutron/extensions/segment.py</literal> defines the extension</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>neutron/db/models/segment.py</literal> defines the DB models for segments and for
                        the segment host mapping, that is used in the implementation of routed
                        networks.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>neutron/db/segments_db.py</literal> has functions to add, retrieve and delete
                        segments from the DB.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>neutron/services/segments/db.py</literal> defines a mixin class with the methods
                        that perform API CRUD operations for the <literal>segments</literal> plug-in. It also has a
                        set of functions to create and maintain the mapping of segments to hosts,
                        which is necessary in the implementation of routed networks.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>neutron/services/segments/plugin.py</literal> defines the <literal>segments</literal> service
                        plug-in.</paragraph>
                </list_item>
            </bullet_list>
        </section>
    </section>
</document>
