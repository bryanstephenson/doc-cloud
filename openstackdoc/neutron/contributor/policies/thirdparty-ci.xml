<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/neutron/doc/source/contributor/policies/thirdparty-ci.rst">
    <section ids="neutron-third-party-ci" names="neutron\ third-party\ ci">
        <title>Neutron Third-party CI</title>
        <section ids="what-is-expected-of-third-party-ci-system-for-neutron" names="what\ is\ expected\ of\ third\ party\ ci\ system\ for\ neutron">
            <title>What Is Expected of Third Party CI System for Neutron</title>
            <paragraph>As of the Liberty summit, Neutron no longer <emphasis>requires</emphasis> a third-party CI,
                but it is strongly encouraged, as internal neutron refactoring can break
                external plugins and drivers at any time.</paragraph>
            <paragraph>Neutron expects any Third Party CI system that interacts with gerrit to
                follow the requirements set by the Infrastructure team <footnote_reference ids="id1" refid="id4">1</footnote_reference> as well as the
                Neutron Third Party CI guidelines below. Please ping the PTL in
                #openstack-neutron or send an email to the openstack-dev ML (with subject
                [neutron]) with any questions. Be aware that the Infrastructure documentation
                as well as this document are living documents and undergo changes. Track
                changes to the infrastructure documentation using this url <footnote_reference ids="id2" refid="id5">2</footnote_reference> (and please
                review the patches) and check this doc on a regular basis for updates.</paragraph>
        </section>
        <section ids="what-changes-to-run-against" names="what\ changes\ to\ run\ against">
            <title>What Changes to Run Against</title>
            <paragraph>If your code is a neutron plugin or driver, you should run against every
                neutron change submitted, except for docs, tests, tools, and top-level
                setup files. You can skip your CI runs for such exceptions by using
                <literal>skip-if</literal> and <literal>all-files-match-any</literal> directives in Zuul.
                You can see a programmatic example of the exceptions here <footnote_reference ids="id3" refid="id6">3</footnote_reference>.</paragraph>
            <paragraph>If your code is in a neutron-*aas repo, you should run against the tests
                for that repo. You may also run against every neutron change, if your service
                driver is using neutron interfaces that are not provided by your service
                plugin (e.g. loadbalancer/plugin.py). If you are using only plugin interfaces,
                it should be safe to test against only the service repo tests.</paragraph>
        </section>
        <section ids="what-tests-to-run" names="what\ tests\ to\ run">
            <title>What Tests To Run</title>
            <paragraph>Network API tests (git link).
                Network scenario tests (The test_network_* tests here).
                Any tests written specifically for your setup.
                <reference refuri="http://git.openstack.org/cgit/openstack/tempest/tree/tempest/api/network">http://git.openstack.org/cgit/openstack/tempest/tree/tempest/api/network</reference></paragraph>
            <paragraph>Run with the test filter: ‘network’. This will include all neutron specific
                tests as well as any other tests that are tagged as requiring networking. An
                example tempest setup for devstack-gate:</paragraph>
            <literal_block xml:space="preserve">export DEVSTACK_GATE_NEUTRON=1
export DEVSTACK_GATE_TEMPEST_REGEX='(?!.*\[.*\bslow\b.*\])((network)|(neutron))'</literal_block>
            <paragraph>An example setup for LBaaS:</paragraph>
            <literal_block xml:space="preserve">export DEVSTACK_GATE_NEUTRON=1
export DEVSTACK_GATE_TEMPEST_REGEX='(?!.*\[.*\bslow\b.*\])(alancer|SimpleReadOnlyNeutron|tempest.api.network)'</literal_block>
        </section>
        <section ids="third-party-ci-voting" names="third\ party\ ci\ voting">
            <title>Third Party CI Voting</title>
            <paragraph>The Neutron team encourages you to NOT vote -1 with a third-party CI. False
                negatives are noisy to the community, and have given -1 from third-party
                CIs a bad reputation. Really bad, to the point of people ignoring them all.
                Failure messages are useful to those doing refactors, and provide you
                feedback on the state of your plugin.</paragraph>
            <paragraph>If you insist on voting, by default, the infra team will not allow voting
                by new 3rd party CI systems. The way to get your 3rd party CI system to vote
                is to talk with the Neutron PTL, who will let infra know the system is ready
                to vote. The requirements for a new system to be given voting rights are as
                follows:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>A new system must be up and running for a month, with a track record of
                        voting on the sandbox system.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>A new system must correctly run and pass tests on patches for the third
                        party driver/plugin for a month.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>A new system must have a logfile setup and retention setup similar to the
                        below.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Once the system has been running for a month, the owner of the third party CI
                system can contact the Neutron PTL to have a conversation about getting voting
                rights upstream.</paragraph>
            <paragraph>The general process to get these voting rights is outlined here. Please follow
                that, taking note of the guidelines Neutron also places on voting for it’s CI
                systems.</paragraph>
            <paragraph>A third party system can have it’s voting rights removed as well. If the
                system becomes unstable (stops running, voting, or start providing inaccurate
                results), the Neutron PTL or any core reviewer will make an attempt to contact
                the owner and copy the openstack-dev mailing list. If no response is received
                within 2 days, the Neutron PTL will remove voting rights for the third party
                CI system. If a response is received, the owner will work to correct the
                issue. If the issue cannot be addressed in a reasonable amount of time, the
                voting rights will be temporarily removed.</paragraph>
        </section>
        <section ids="log-test-results-filesystem-layout" names="log\ &amp;\ test\ results\ filesystem\ layout">
            <title>Log &amp; Test Results Filesystem Layout</title>
            <paragraph>Third-Party CI systems MUST provide logs and configuration data to help
                developers troubleshoot test failures. A third-party CI that DOES NOT post
                logs should be a candidate for removal, and new CI systems MUST post logs
                before they can be awarded voting privileges.</paragraph>
            <paragraph>Third party CI systems should follow the filesystem layout convention of the
                OpenStack CI system. Please store your logs as viewable in a web browser, in
                a directory structure. Requiring the user to download a giant tarball is not
                acceptable, and will be reason to not allow your system to vote from the
                start, or cancel it’s voting rights if this changes while the system is
                running.</paragraph>
            <paragraph>At the root of the results - there should be the following:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>console.html.gz - contains the output of stdout of the test run</paragraph>
                </list_item>
                <list_item>
                    <paragraph>local.conf / localrc - contains the setup used for this run</paragraph>
                </list_item>
                <list_item>
                    <paragraph>logs - contains the output of detail test log of the test run</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>The above “logs” must be a directory, which contains the following:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Log files for each screen session that DevStack creates and launches an
                        OpenStack component in</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Test result files</paragraph>
                </list_item>
                <list_item>
                    <paragraph>testr_results.html.gz</paragraph>
                </list_item>
                <list_item>
                    <paragraph>tempest.txt.gz</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="list-of-existing-plugins-and-drivers" names="list\ of\ existing\ plugins\ and\ drivers">
            <title>List of existing plugins and drivers</title>
            <paragraph><reference refuri="https://wiki.openstack.org/wiki/Neutron_Plugins_and_Drivers#Existing_Plugin_and_Drivers">https://wiki.openstack.org/wiki/Neutron_Plugins_and_Drivers#Existing_Plugin_and_Drivers</reference></paragraph>
        </section>
        <section ids="references" names="references">
            <title>References</title>
            <footnote backrefs="id1" ids="id4" names="1">
                <label>1</label>
                <paragraph><reference refuri="http://ci.openstack.org/third_party.html">http://ci.openstack.org/third_party.html</reference></paragraph>
            </footnote>
            <footnote backrefs="id2" ids="id5" names="2">
                <label>2</label>
                <paragraph><reference refuri="https://review.openstack.org/#/q/status:open+project:openstack-infra/system-config+branch:master+topic:third-party,n,z">https://review.openstack.org/#/q/status:open+project:openstack-infra/system-config+branch:master+topic:third-party,n,z</reference></paragraph>
            </footnote>
            <footnote backrefs="id3" ids="id6" names="3">
                <label>3</label>
                <paragraph><reference refuri="https://github.com/openstack-infra/project-config/blob/master/zuul/layout.yaml">https://github.com/openstack-infra/project-config/blob/master/zuul/layout.yaml</reference></paragraph>
            </footnote>
        </section>
    </section>
</document>
