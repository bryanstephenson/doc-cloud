<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/neutron/doc/source/contributor/policies/gate-failure-triage.rst">
    <section ids="neutron-gate-failure-triage" names="neutron\ gate\ failure\ triage">
        <title>Neutron Gate Failure Triage</title>
        <paragraph>This page provides guidelines for spotting and assessing neutron gate failures. Some hints for triaging
            failures are also provided.</paragraph>
        <section ids="spotting-gate-failures" names="spotting\ gate\ failures">
            <title>Spotting Gate Failures</title>
            <paragraph>This can be achieved using several tools:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph><reference name="Grafana dashboard" refuri="http://grafana.openstack.org/dashboard/db/neutron-failure-rate">Grafana dashboard</reference><target ids="grafana-dashboard" names="grafana\ dashboard" refuri="http://grafana.openstack.org/dashboard/db/neutron-failure-rate"></target></paragraph>
                </list_item>
                <list_item>
                    <paragraph><reference name="logstash" refuri="http://logstash.openstack.org/">logstash</reference><target ids="logstash" names="logstash" refuri="http://logstash.openstack.org/"></target></paragraph>
                </list_item>
            </bullet_list>
            <paragraph>For checking gate failures with logstash the following query will return failures for a specific job:</paragraph>
            <paragraph>&gt; build_status:FAILURE AND message:Finished  AND build_name:”check-tempest-dsvm-neutron” AND build_queue:”gate”</paragraph>
            <paragraph>And divided by the total number of jobs executed:</paragraph>
            <paragraph>&gt; message:Finished  AND build_name:”check-tempest-dsvm-neutron” AND build_queue:”gate”</paragraph>
            <paragraph>It will return the failure rate in the selected period for a given job. It is important to remark that
                failures in the check queue might be misleading as the problem causing the failure is most of the time in
                the patch being checked. Therefore it is always advisable to work on failures occurred in the gate queue.
                However, these failures are a precious resource for assessing frequency and determining root cause of
                failures which manifest in the gate queue.</paragraph>
            <paragraph>The step above will provide a quick outlook of where things stand. When the failure rate raises above 10% for
                a job in 24 hours, it’s time to be on alert. 25% is amber alert. 33% is red alert. Anything above 50% means
                that probably somebody from the infra team has already a contract out on you. Whether you are relaxed, in
                alert mode, or freaking out because you see a red dot on your chest, it is always a good idea to check on
                daily bases the elastic-recheck pages.</paragraph>
            <paragraph>Under the <reference name="gate pipeline" refuri="http://status.openstack.org/elastic-recheck/gate.html">gate pipeline</reference><target ids="gate-pipeline" names="gate\ pipeline" refuri="http://status.openstack.org/elastic-recheck/gate.html"></target> tab, you can see gate
                failure rates for already known bugs. The bugs in this page are ordered by decreasing failure rates (for the
                past 24 hours). If one of the bugs affecting Neutron is among those on top of that list, you should check
                that the corresponding bug is already assigned and somebody is working on it. If not, and there is not a good
                reason for that, it should be ensured somebody gets a crack at it as soon as possible. The other part of the
                story is to check for <reference name="uncategorized" refuri="http://status.openstack.org/elastic-recheck/data/uncategorized.html">uncategorized</reference><target ids="uncategorized" names="uncategorized" refuri="http://status.openstack.org/elastic-recheck/data/uncategorized.html"></target>
                failures. This is where failures for new (unknown) gate breaking bugs end up; on the other hand also infra
                error causing job failures end up here. It should be duty of the diligent Neutron developer to ensure the
                classification rate for neutron jobs is as close as possible to 100%. To this aim, the diligent Neutron
                developer should adopt the procedure outlined in the following sections.</paragraph>
            <target refid="troubleshooting-tempest-jobs"></target>
        </section>
        <section ids="troubleshooting-tempest-jobs id1" names="troubleshooting\ tempest\ jobs troubleshooting-tempest-jobs">
            <title>Troubleshooting Tempest jobs</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Open logs for failed jobs and look for logs/testr_results.html.gz.</paragraph>
                </list_item>
                <list_item>
                    <definition_list>
                        <definition_list_item>
                            <term>If that file is missing, check console.html and see where the job failed.</term>
                            <definition>
                                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                                    <list_item>
                                        <paragraph>If there is a failure in devstack-gate-cleanup-host.txt it’s likely to be an infra issue.</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>If the failure is in devstacklog.txt it could a devstack, neutron, or infra issue.</paragraph>
                                    </list_item>
                                </enumerated_list>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
                <list_item>
                    <paragraph>However, most of the time the failure is in one of the tempest tests. Take note of the error message and go to
                        logstash.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>On logstash, search for occurrences of this error message, and try to identify the root cause for the failure
                        (see below).</paragraph>
                </list_item>
                <list_item>
                    <paragraph>File a bug for this failure, and push an <reference internal="True" refid="elastic-recheck-query"><inline classes="std std-ref">Elastic Recheck Query</inline></reference> for it.</paragraph>
                </list_item>
                <list_item>
                    <definition_list>
                        <definition_list_item>
                            <term>If you are confident with the area of this bug, and you have time, assign it to yourself; otherwise look for an</term>
                            <definition>
                                <paragraph>assignee or talk to the Neutron’s bug czar to find an assignee.</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="troubleshooting-functional-fullstack-job" names="troubleshooting\ functional/fullstack\ job">
            <title>Troubleshooting functional/fullstack job</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Go to the job link provided by Jenkins CI.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Look at logs/testr_results.html.gz for which particular test failed.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>More logs from a particular test are stored at
                        logs/dsvm-functional-logs/&lt;path_of_the_test&gt; (or dsvm-fullstack-logs
                        for fullstack job).</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Find the error in the logs and search for similar errors in existing
                        launchpad bugs. If no bugs were reported, create a new bug report. Don’t
                        forget to put a snippet of the trace into the new launchpad bug. If the
                        log file for a particular job doesn’t contain any trace, pick the one
                        from testr_results.html.gz.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create an <reference internal="True" refid="elastic-recheck-query"><inline classes="std std-ref">Elastic Recheck Query</inline></reference></paragraph>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="root-causing-a-gate-failure" names="root\ causing\ a\ gate\ failure">
            <title>Root Causing a Gate Failure</title>
            <paragraph>Time-based identification, i.e. find the naughty patch by log scavenging.</paragraph>
            <target refid="elastic-recheck-query"></target>
        </section>
        <section ids="filing-an-elastic-recheck-query elastic-recheck-query" names="filing\ an\ elastic\ recheck\ query elastic-recheck-query">
            <title>Filing An Elastic Recheck Query</title>
            <paragraph>The <reference name="elastic recheck" refuri="http://status.openstack.org/elastic-recheck/">elastic recheck</reference><target ids="elastic-recheck" names="elastic\ recheck" refuri="http://status.openstack.org/elastic-recheck/"></target> page has all the current open ER queries.
                To file one, please see the <reference name="ER Wiki" refuri="https://wiki.openstack.org/wiki/ElasticRecheck">ER Wiki</reference><target ids="er-wiki" names="er\ wiki" refuri="https://wiki.openstack.org/wiki/ElasticRecheck"></target>.</paragraph>
        </section>
    </section>
</document>
