<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/neutron/doc/source/install/controller-install-ubuntu.rst">
    <section ids="install-and-configure-controller-node" names="install\ and\ configure\ controller\ node">
        <title>Install and configure controller node</title>
        <section ids="prerequisites" names="prerequisites">
            <title>Prerequisites</title>
            <paragraph>Before you configure the OpenStack Networking (neutron) service, you
                must create a database, service credentials, and API endpoints.</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>To create the database, complete these steps:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>Use the database access client to connect to the database
                                server as the <literal>root</literal> user:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ mysql -u root -p</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>Create the <literal>neutron</literal> database:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">MariaDB [(none)] CREATE DATABASE neutron;</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>Grant proper access to the <literal>neutron</literal> database, replacing
                                <literal>NEUTRON_DBPASS</literal> with a suitable password:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' \
  IDENTIFIED BY 'NEUTRON_DBPASS';
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'%' \
  IDENTIFIED BY 'NEUTRON_DBPASS';</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>Exit the database access client.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Source the <literal>admin</literal> credentials to gain access to admin-only CLI
                        commands:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ . admin-openrc</literal_block>
                    <comment xml:space="preserve">end</comment>
                </list_item>
                <list_item>
                    <paragraph>To create the service credentials, complete these steps:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>Create the <literal>neutron</literal> user:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack user create --domain default --password-prompt neutron

User Password:
Repeat User Password:
+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | fdb0f541e28141719b6a43c8944bf1fb |
| name                | neutron                          |
| options             | {}                               |
| password_expires_at | None                             |
+---------------------+----------------------------------+</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>Add the <literal>admin</literal> role to the <literal>neutron</literal> user:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack role add --project service --user neutron admin</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <note>
                                <paragraph>This command provides no output.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>Create the <literal>neutron</literal> service entity:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack service create --name neutron \
  --description "OpenStack Networking" network

+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Networking             |
| enabled     | True                             |
| id          | f71529314dab4a4d8eca427e701d209e |
| name        | neutron                          |
| type        | network                          |
+-------------+----------------------------------+</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Create the Networking service API endpoints:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack endpoint create --region RegionOne \
  network public http://controller:9696

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 85d80a6d02fc4b7683f611d7fc1493a3 |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | f71529314dab4a4d8eca427e701d209e |
| service_name | neutron                          |
| service_type | network                          |
| url          | http://controller:9696           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  network internal http://controller:9696

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 09753b537ac74422a68d2d791cf3714f |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | f71529314dab4a4d8eca427e701d209e |
| service_name | neutron                          |
| service_type | network                          |
| url          | http://controller:9696           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  network admin http://controller:9696

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 1ee14289c9374dffb5db92a5c112fc4e |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | f71529314dab4a4d8eca427e701d209e |
| service_name | neutron                          |
| service_type | network                          |
| url          | http://controller:9696           |
+--------------+----------------------------------+</literal_block>
                    <comment xml:space="preserve">end</comment>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="configure-networking-options" names="configure\ networking\ options">
            <title>Configure networking options</title>
            <paragraph>You can deploy the Networking service using one of two architectures
                represented by options 1 and 2.</paragraph>
            <paragraph>Option 1 deploys the simplest possible architecture that only supports
                attaching instances to provider (external) networks. No self-service (private)
                networks, routers, or floating IP addresses. Only the <literal>admin</literal> or other
                privileged user can manage provider networks.</paragraph>
            <paragraph>Option 2 augments option 1 with layer-3 services that support attaching
                instances to self-service networks. The <literal>demo</literal> or other unprivileged
                user can manage self-service networks including routers that provide
                connectivity between self-service and provider networks. Additionally,
                floating IP addresses provide connectivity to instances using self-service
                networks from external networks such as the Internet.</paragraph>
            <paragraph>Self-service networks typically use overlay networks. Overlay network
                protocols such as VXLAN include additional headers that increase overhead
                and decrease space available for the payload or user data. Without knowledge
                of the virtual network infrastructure, instances attempt to send packets
                using the default Ethernet maximum transmission unit (MTU) of 1500
                bytes. The Networking service automatically provides the correct MTU value
                to instances via DHCP. However, some cloud images do not use DHCP or ignore
                the DHCP MTU option and require configuration using metadata or a script.</paragraph>
            <note>
                <paragraph>Option 2 also supports attaching instances to provider networks.</paragraph>
            </note>
            <paragraph>Choose one of the following networking options to configure services
                specific to it. Afterwards, return here and proceed to
                <reference internal="True" refid="neutron-controller-metadata-agent-ubuntu"><inline classes="std std-ref">Configure the metadata agent</inline></reference>.</paragraph>
            <compound classes="toctree-wrapper">
                <compact_paragraph toctree="True"><bullet_list><list_item classes="toctree-l1"><compact_paragraph classes="toctree-l1"><reference anchorname="" internal="True" refuri="controller-install-option1-ubuntu">Networking Option 1: Provider networks</reference></compact_paragraph></list_item><list_item classes="toctree-l1"><compact_paragraph classes="toctree-l1"><reference anchorname="" internal="True" refuri="controller-install-option2-ubuntu">Networking Option 2: Self-service networks</reference></compact_paragraph></list_item></bullet_list></compact_paragraph>
            </compound>
            <target refid="neutron-controller-metadata-agent-ubuntu"></target>
        </section>
        <section ids="configure-the-metadata-agent neutron-controller-metadata-agent-ubuntu" names="configure\ the\ metadata\ agent neutron-controller-metadata-agent-ubuntu">
            <title>Configure the metadata agent</title>
            <paragraph>The metadata agent provides configuration information
                such as credentials to instances.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Edit the <literal>/etc/neutron/metadata_agent.ini</literal> file and complete the following
                        actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure the metadata host and shared
                                secret:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/metadata_agent.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
nova_metadata_host = controller
metadata_proxy_shared_secret = METADATA_SECRET</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>METADATA_SECRET</literal> with a suitable secret for the metadata proxy.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="configure-the-compute-service-to-use-the-networking-service" names="configure\ the\ compute\ service\ to\ use\ the\ networking\ service">
            <title>Configure the Compute service to use the Networking service</title>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Edit the <literal>/etc/nova/nova.conf</literal> file and perform the following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[neutron]</literal> section, configure access parameters, enable the
                                metadata proxy, and configure the secret:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[neutron]
# ...
url = http://controller:9696
auth_url = http://controller:35357
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = RegionOne
project_name = service
username = neutron
password = NEUTRON_PASS
service_metadata_proxy = true
metadata_proxy_shared_secret = METADATA_SECRET</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>NEUTRON_PASS</literal> with the password you chose for the <literal>neutron</literal>
                                user in the Identity service.</paragraph>
                            <paragraph>Replace <literal>METADATA_SECRET</literal> with the secret you chose for the metadata
                                proxy.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="finalize-installation" names="finalize\ installation">
            <title>Finalize installation</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Populate the database:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># su -s /bin/sh -c "neutron-db-manage --config-file /etc/neutron/neutron.conf \
  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head" neutron</literal_block>
                    <comment xml:space="preserve">end</comment>
                    <note>
                        <paragraph>Database population occurs later for Networking because the script
                            requires complete server and plug-in configuration files.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Restart the Compute API service:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># service nova-api restart</literal_block>
                    <comment xml:space="preserve">end</comment>
                </list_item>
                <list_item>
                    <paragraph>Restart the Networking services.</paragraph>
                    <paragraph>For both networking options:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># service neutron-server restart
# service neutron-linuxbridge-agent restart
# service neutron-dhcp-agent restart
# service neutron-metadata-agent restart</literal_block>
                    <comment xml:space="preserve">end</comment>
                    <paragraph>For networking option 2, also restart the layer-3 service:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># service neutron-l3-agent restart</literal_block>
                    <comment xml:space="preserve">end</comment>
                </list_item>
            </enumerated_list>
        </section>
    </section>
</document>
