<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/neutron/doc/source/install/controller-install-option2-rdo.rst">
    <section ids="networking-option-2-self-service-networks" names="networking\ option\ 2:\ self-service\ networks">
        <title>Networking Option 2: Self-service networks</title>
        <paragraph>Install and configure the Networking components on the <emphasis>controller</emphasis> node.</paragraph>
        <section ids="install-the-components" names="install\ the\ components">
            <title>Install the components</title>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># yum install openstack-neutron openstack-neutron-ml2 \
  openstack-neutron-linuxbridge ebtables</literal_block>
            <comment xml:space="preserve">end</comment>
        </section>
        <section ids="configure-the-server-component" names="configure\ the\ server\ component">
            <title>Configure the server component</title>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Edit the <literal>/etc/neutron/neutron.conf</literal> file and complete the following
                        actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[database]</literal> section, configure database access:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/neutron.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[database]
# ...
connection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>NEUTRON_DBPASS</literal> with the password you chose for the
                                database.</paragraph>
                            <note>
                                <paragraph>Comment out or remove any other <literal>connection</literal> options in the
                                    <literal>[database]</literal> section.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, enable the Modular Layer 2 (ML2)
                                plug-in, router service, and overlapping IP addresses:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/neutron.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
core_plugin = ml2
service_plugins = router
allow_overlapping_ips = true</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure <literal>RabbitMQ</literal>
                                message queue access:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/neutron.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
transport_url = rabbit://openstack:RABBIT_PASS@controller</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>RABBIT_PASS</literal> with the password you chose for the
                                <literal>openstack</literal> account in RabbitMQ.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> and <literal>[keystone_authtoken]</literal> sections, configure
                                Identity service access:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/neutron.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
auth_strategy = keystone

[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = neutron
password = NEUTRON_PASS</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>NEUTRON_PASS</literal> with the password you chose for the <literal>neutron</literal>
                                user in the Identity service.</paragraph>
                            <note>
                                <paragraph>Comment out or remove any other options in the
                                    <literal>[keystone_authtoken]</literal> section.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> and <literal>[nova]</literal> sections, configure Networking to
                                notify Compute of network topology changes:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/neutron.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
notify_nova_on_port_status_changes = true
notify_nova_on_port_data_changes = true

[nova]
# ...
auth_url = http://controller:35357
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = RegionOne
project_name = service
username = nova
password = NOVA_PASS</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>NOVA_PASS</literal> with the password you chose for the <literal>nova</literal>
                                user in the Identity service.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>In the <literal>[oslo_concurrency]</literal> section, configure the lock path:</paragraph>
                    <comment xml:space="preserve">path /etc/neutron/neutron.conf</comment>
                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[oslo_concurrency]
# ...
lock_path = /var/lib/neutron/tmp</literal_block>
                    <comment xml:space="preserve">end</comment>
                </list_item>
            </bullet_list>
        </section>
        <section ids="configure-the-modular-layer-2-ml2-plug-in" names="configure\ the\ modular\ layer\ 2\ (ml2)\ plug-in">
            <title>Configure the Modular Layer 2 (ML2) plug-in</title>
            <paragraph>The ML2 plug-in uses the Linux bridge mechanism to build layer-2 (bridging
                and switching) virtual networking infrastructure for instances.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Edit the <literal>/etc/neutron/plugins/ml2/ml2_conf.ini</literal> file and complete the
                        following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[ml2]</literal> section, enable flat, VLAN, and VXLAN networks:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2]
# ...
type_drivers = flat,vlan,vxlan</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[ml2]</literal> section, enable VXLAN self-service networks:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2]
# ...
tenant_network_types = vxlan</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[ml2]</literal> section, enable the Linux bridge and layer-2 population
                                mechanisms:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2]
# ...
mechanism_drivers = linuxbridge,l2population</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <warning>
                                <paragraph>After you configure the ML2 plug-in, removing values in the
                                    <literal>type_drivers</literal> option can lead to database inconsistency.</paragraph>
                            </warning>
                            <note>
                                <paragraph>The Linux bridge agent only supports VXLAN overlay networks.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[ml2]</literal> section, enable the port security extension driver:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2]
# ...
extension_drivers = port_security</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[ml2_type_flat]</literal> section, configure the provider virtual
                                network as a flat network:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2_type_flat]
# ...
flat_networks = provider</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[ml2_type_vxlan]</literal> section, configure the VXLAN network identifier
                                range for self-service networks:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2_type_vxlan]
# ...
vni_ranges = 1:1000</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[securitygroup]</literal> section, enable ipset to increase
                                efficiency of security group rules:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[securitygroup]
# ...
enable_ipset = true</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="configure-the-linux-bridge-agent" names="configure\ the\ linux\ bridge\ agent">
            <title>Configure the Linux bridge agent</title>
            <paragraph>The Linux bridge agent builds layer-2 (bridging and switching) virtual
                networking infrastructure for instances and handles security groups.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Edit the <literal>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</literal> file and
                        complete the following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[linux_bridge]</literal> section, map the provider virtual network to the
                                provider physical network interface:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/linuxbridge_agent.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[linux_bridge]
physical_interface_mappings = provider:PROVIDER_INTERFACE_NAME</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>PROVIDER_INTERFACE_NAME</literal> with the name of the underlying
                                provider physical network interface. See <reference internal="True" refuri="environment-networking-rdo"><inline classes="doc">Host networking</inline></reference>
                                for more information.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[vxlan]</literal> section, enable VXLAN overlay networks, configure the
                                IP address of the physical network interface that handles overlay
                                networks, and enable layer-2 population:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/linuxbridge_agent.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[vxlan]
enable_vxlan = true
local_ip = OVERLAY_INTERFACE_IP_ADDRESS
l2_population = true</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>OVERLAY_INTERFACE_IP_ADDRESS</literal> with the IP address of the
                                underlying physical network interface that handles overlay networks. The
                                example architecture uses the management interface to tunnel traffic to
                                the other nodes. Therefore, replace <literal>OVERLAY_INTERFACE_IP_ADDRESS</literal> with
                                the management IP address of the controller node. See
                                <reference internal="True" refuri="environment-networking-rdo"><inline classes="doc">Host networking</inline></reference> for more information.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[securitygroup]</literal> section, enable security groups and
                                configure the Linux bridge iptables firewall driver:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/linuxbridge_agent.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[securitygroup]
# ...
enable_security_group = true
firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="configure-the-layer-3-agent" names="configure\ the\ layer-3\ agent">
            <title>Configure the layer-3 agent</title>
            <paragraph>The Layer-3 (L3) agent provides routing and NAT services for
                self-service virtual networks.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Edit the <literal>/etc/neutron/l3_agent.ini</literal> file and complete the following
                        actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure the Linux bridge interface driver
                                and external network bridge:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/l3_agent.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
interface_driver = linuxbridge</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="configure-the-dhcp-agent" names="configure\ the\ dhcp\ agent">
            <title>Configure the DHCP agent</title>
            <paragraph>The DHCP agent provides DHCP services for virtual networks.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Edit the <literal>/etc/neutron/dhcp_agent.ini</literal> file and complete the following
                        actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure the Linux bridge interface driver,
                                Dnsmasq DHCP driver, and enable isolated metadata so instances on provider
                                networks can access metadata over the network:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/dhcp_agent.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
interface_driver = linuxbridge
dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq
enable_isolated_metadata = true</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
            <paragraph>Return to <emphasis>Networking controller node configuration</emphasis>.</paragraph>
        </section>
    </section>
</document>
