<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/neutron/doc/source/install/controller-install-option1-obs.rst">
    <section ids="networking-option-1-provider-networks" names="networking\ option\ 1:\ provider\ networks">
        <title>Networking Option 1: Provider networks</title>
        <paragraph>Install and configure the Networking components on the <emphasis>controller</emphasis> node.</paragraph>
        <section ids="install-the-components" names="install\ the\ components">
            <title>Install the components</title>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># zypper install --no-recommends openstack-neutron \
  openstack-neutron-server openstack-neutron-linuxbridge-agent \
  openstack-neutron-dhcp-agent openstack-neutron-metadata-agent \
  bridge-utils</literal_block>
            <comment xml:space="preserve">end</comment>
        </section>
        <section ids="configure-the-server-component" names="configure\ the\ server\ component">
            <title>Configure the server component</title>
            <paragraph>The Networking server component configuration includes the database,
                authentication mechanism, message queue, topology change notifications,
                and plug-in.</paragraph>
            <note>
                <paragraph>Default configuration files vary by distribution. You might need
                    to add these sections and options rather than modifying existing
                    sections and options. Also, an ellipsis (<literal>...</literal>) in the configuration
                    snippets indicates potential default configuration options that you
                    should retain.</paragraph>
            </note>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Edit the <literal>/etc/neutron/neutron.conf</literal> file and complete the following
                        actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[database]</literal> section, configure database access:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/neutron.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[database]
# ...
connection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>NEUTRON_DBPASS</literal> with the password you chose for the
                                database.</paragraph>
                            <note>
                                <paragraph>Comment out or remove any other <literal>connection</literal> options in the
                                    <literal>[database]</literal> section.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, enable the Modular Layer 2 (ML2)
                                plug-in and disable additional plug-ins:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/neutron.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
core_plugin = ml2
service_plugins =</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure <literal>RabbitMQ</literal>
                                message queue access:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/neutron.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
transport_url = rabbit://openstack:RABBIT_PASS@controller</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>RABBIT_PASS</literal> with the password you chose for the
                                <literal>openstack</literal> account in RabbitMQ.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> and <literal>[keystone_authtoken]</literal> sections, configure
                                Identity service access:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/neutron.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
auth_strategy = keystone

[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = neutron
password = NEUTRON_PASS</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>NEUTRON_PASS</literal> with the password you chose for the <literal>neutron</literal>
                                user in the Identity service.</paragraph>
                            <note>
                                <paragraph>Comment out or remove any other options in the
                                    <literal>[keystone_authtoken]</literal> section.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> and <literal>[nova]</literal> sections, configure Networking to
                                notify Compute of network topology changes:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/neutron.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
notify_nova_on_port_status_changes = true
notify_nova_on_port_data_changes = true

[nova]
# ...
auth_url = http://controller:35357
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = RegionOne
project_name = service
username = nova
password = NOVA_PASS</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>NOVA_PASS</literal> with the password you chose for the <literal>nova</literal>
                                user in the Identity service.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="configure-the-modular-layer-2-ml2-plug-in" names="configure\ the\ modular\ layer\ 2\ (ml2)\ plug-in">
            <title>Configure the Modular Layer 2 (ML2) plug-in</title>
            <paragraph>The ML2 plug-in uses the Linux bridge mechanism to build layer-2 (bridging
                and switching) virtual networking infrastructure for instances.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Edit the <literal>/etc/neutron/plugins/ml2/ml2_conf.ini</literal> file and complete the
                        following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[ml2]</literal> section, enable flat and VLAN networks:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2]
# ...
type_drivers = flat,vlan</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[ml2]</literal> section, disable self-service networks:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2]
# ...
tenant_network_types =</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[ml2]</literal> section, enable the Linux bridge mechanism:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2]
# ...
mechanism_drivers = linuxbridge</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <warning>
                                <paragraph>After you configure the ML2 plug-in, removing values in the
                                    <literal>type_drivers</literal> option can lead to database inconsistency.</paragraph>
                            </warning>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[ml2]</literal> section, enable the port security extension driver:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2]
# ...
extension_drivers = port_security</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[ml2_type_flat]</literal> section, configure the provider virtual
                                network as a flat network:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[ml2_type_flat]
# ...
flat_networks = provider</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[securitygroup]</literal> section, enable ipset to increase
                                efficiency of security group rules:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/ml2_conf.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[securitygroup]
# ...
enable_ipset = true</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="configure-the-linux-bridge-agent" names="configure\ the\ linux\ bridge\ agent">
            <title>Configure the Linux bridge agent</title>
            <paragraph>The Linux bridge agent builds layer-2 (bridging and switching) virtual
                networking infrastructure for instances and handles security groups.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Edit the <literal>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</literal> file and
                        complete the following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[linux_bridge]</literal> section, map the provider virtual network to the
                                provider physical network interface:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/linuxbridge_agent.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[linux_bridge]
physical_interface_mappings = provider:PROVIDER_INTERFACE_NAME</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>PROVIDER_INTERFACE_NAME</literal> with the name of the underlying
                                provider physical network interface. See <reference internal="True" refuri="environment-networking-obs"><inline classes="doc">Host networking</inline></reference>
                                for more information.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[vxlan]</literal> section, disable VXLAN overlay networks:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/linuxbridge_agent.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[vxlan]
enable_vxlan = false</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[securitygroup]</literal> section, enable security groups and
                                configure the Linux bridge iptables firewall driver:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/plugins/ml2/linuxbridge_agent.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[securitygroup]
# ...
enable_security_group = true
firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="configure-the-dhcp-agent" names="configure\ the\ dhcp\ agent">
            <title>Configure the DHCP agent</title>
            <paragraph>The DHCP agent provides DHCP services for virtual networks.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Edit the <literal>/etc/neutron/dhcp_agent.ini</literal> file and complete the following
                        actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure the Linux bridge interface driver,
                                Dnsmasq DHCP driver, and enable isolated metadata so instances on provider
                                networks can access metadata over the network:</paragraph>
                            <comment xml:space="preserve">path /etc/neutron/dhcp_agent.ini</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
interface_driver = linuxbridge
dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq
enable_isolated_metadata = true</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
            <paragraph>Return to <emphasis>Networking controller node configuration</emphasis>.</paragraph>
        </section>
    </section>
</document>
