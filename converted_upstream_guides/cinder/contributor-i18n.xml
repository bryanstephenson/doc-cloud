<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook">
  <title>Internationalization</title>
  <para>For internationalization guidelines, see the
            <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://docs.openstack.org/developer/oslo.i18n/guidelines.html">oslo.i18n documentation</link>.
            The information below can be used to get started.</para>
  <para>Cinder uses <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://docs.python.org/library/gettext.html">gettext</link> so that
            user-facing strings such as log messages appear in the appropriate
            language in different locales.</para>
  <para>To use gettext, make sure that the strings passed to the logger are wrapped
            in a <literal>_Lx()</literal> function call. For example:</para>
  <screen>LOG.info(_LI("block_device_mapping %s"), block_device_mapping)</screen>
  <para>There are a few different _() translation markers, depending on the logging
            level of the text:</para>
  <itemizedlist>
    <listitem>
      <para>_LI() - Used for INFO level log messages</para>
    </listitem>
    <listitem>
      <para>_LW() - Used for WARNING level log messages</para>
    </listitem>
    <listitem>
      <para>_LE() - Used for ERROR level log messages (this includes LOG.exception)</para>
    </listitem>
    <listitem>
      <variablelist>
        <varlistentry>
          <term>_() - Used for any exception messages, including strings used for both</term>
          <listitem>
            <para>logging and exceptions.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </listitem>
  </itemizedlist>
  <note>
    <para>Starting with the Pike series, OpenStack no longer supports log
                translation markers like <literal>_Lx()</literal>, only <literal>_()</literal> should still be used for
                exceptions that could be user facing. It is not necessary to add <literal>_Lx()</literal>
                translation instructions to new code, and the instructions can be removed
                from old code. Refer to the email thread <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://lists.openstack.org/pipermail/openstack-dev/2017-March/thread.html#113365">understanding log domain change</link>
                on the openstack-dev mailing list for more details.</para>
  </note>
  <para>Do not use <literal>locals()</literal> for formatting messages because:</para>
  <procedure>
    <step>
      <para>It is not as clear as using explicit dicts.</para>
    </step>
    <step>
      <para>It could produce hidden errors during refactoring.</para>
    </step>
    <step>
      <para>Changing the name of a variable causes a change in the message.</para>
    </step>
    <step>
      <para>It creates a lot of otherwise unused variables.</para>
    </step>
  </procedure>
  <para>If you do not follow the project conventions, your code may cause pep8 hacking
            check failures.</para>
  <para>For translation to work properly, the top level scripts for Cinder need
            to first do the following before any Cinder modules are imported:</para>
  <screen>from cinder import i18n
i18n.enable_lazy()</screen>
  <para>Note: this should _only_ be called from top level scripts - no library code
            or common modules should call this method.</para>
  <para>Any files that use the _() for translation then must have the following
            lines:</para>
  <screen>from cinder.i18n import _</screen>
  <para>If the above code is missing, it may result in an error that looks
            like:</para>
  <screen>NameError: name '_' is not defined</screen>
</section>
