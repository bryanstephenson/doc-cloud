<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>Themes</title>
  <para>As of the Kilo release, styling for the OpenStack Dashboard can be altered
            through the use of a theme. A theme is a directory containing a
            <literal>_variables.scss</literal> file to override the color codes used throughout the SCSS
            and a <literal>_styles.scss</literal> file with additional styles to load after dashboard
            styles have loaded.</para>
  <para>As of the Mitaka release, Horizon can be configured to run with multiple
            themes available at run time.  It uses a browser cookie to allow users to
            toggle between the configured themes.  By default, Horizon is configured
            with the two standard themes available: ‘default’ and ‘material’.</para>
  <para>To configure or alter the available themes, set <literal>AVAILABLE_THEMES</literal> in
            <literal>local_settings.py</literal> to a list of tuples, such that
            <literal>('name', 'label', 'path')</literal></para>
  <variablelist>
    <varlistentry>
      <term>
        <literal>name</literal>
      </term>
      <listitem>
        <para>The key by which the theme value is stored within the cookie</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>
        <literal>label</literal>
      </term>
      <listitem>
        <para>The label shown in the theme toggle under the User Menu</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>
        <literal>path</literal>
      </term>
      <listitem>
        <para>The directory location for the theme. The path must be relative to the
                        <literal>openstack_dashboard</literal> directory or an absolute path to an accessible
                        location on the file system</para>
      </listitem>
    </varlistentry>
  </variablelist>
  <para>To use a custom theme, set <literal>AVAILABLE_THEMES</literal> in <literal>local_settings.py</literal> to
            a list of themes.  If you wish to run in a mode similar to legacy Horizon,
            set <literal>AVAILABLE_THEMES</literal> with a single tuple, and the theme toggle will not
            be available at all through the application to allow user configuration themes.</para>
  <para>For example, a configuration with multiple themes:</para>
  <screen>AVAILABLE_THEMES = [
    ('default', 'Default', 'themes/default'),
    ('material', 'Material', 'themes/material'),
]</screen>
  <para>A configuration with a single theme:</para>
  <screen>AVAILABLE_THEMES = [
    ('default', 'Default', 'themes/default'),
]</screen>
  <para>Both the Dashboard custom variables and Bootstrap variables can be overridden.
            For a full list of the Dashboard SCSS variables that can be changed,
            see the variables file at
            <literal>openstack_dashboard/static/dashboard/scss/_variables.scss</literal>.</para>
  <para>In order to build a custom theme, both <literal>_variables.scss</literal> and <literal>_styles.scss</literal>
            are required and <literal>_variables.scss</literal> must provide all the default Bootstrap
            variables.</para>
  <section>
    <title>Inherit from an Existing Theme</title>
    <para>Custom themes must implement all of the Bootstrap variables required by
                Horizon in <literal>_variables.scss</literal> and <literal>_styles.scss</literal>. To make this easier, you
                can inherit the variables needed in the default theme and only override those
                that you need to customize. To inherit from the default theme, put this in your
                theme’s <literal>_variables.scss</literal>:</para>
    <screen>@import "/themes/default/variables";</screen>
    <variablelist>
      <varlistentry>
        <term>Once you have made your changes you must re-generate the static files with</term>
        <listitem>
          <para><literal>tox -e manage -- collectstatic</literal>.</para>
        </listitem>
      </varlistentry>
    </variablelist>
    <para>By default, all of the themes configured by <literal>AVAILABLE_THEMES</literal> setting are
                collected by horizon during the <literal>collectstatic</literal> process. By default, the themes
                are collected into the dynamic <literal>static/themes</literal> directory, but this location can
                be customized via the <literal>local_settings.py</literal> variable: <literal>THEME_COLLECTION_DIR</literal></para>
    <para>Once collected, any theme configured via <literal>AVAILABLE_THEMES</literal> is available to
                inherit from by importing its variables and styles from its collection
                directory.  The following is an example of inheriting from the material theme:</para>
    <screen>@import "/themes/material/variables";
@import "/themes/material/styles";</screen>
    <para>All themes will need to be configured in <literal>AVAILABLE_THEMES</literal> to allow
                inheritance.  If you wish to inherit from a theme, but not show that theme
                as a selectable option in the theme picker widget, then simply configure the
                <literal>SELECTABLE_THEMES</literal> to exclude the parent theme.  <literal>SELECTABLE_THEMES</literal> must
                be of the same format as <literal>AVAILABLE_THEMES</literal>.  It defaults to
                <literal>AVAILABLE_THEMES</literal> if it is not set explicitly.</para>
    <section>
      <title>Bootswatch</title>
      <para>Horizon packages the Bootswatch SCSS files for use with its <literal>material</literal> theme.
                    Because of this, it is simple to use an existing Bootswatch theme as a base.
                    This is due to the fact that Bootswatch is loaded as a 3rd party static asset,
                    and therefore is automatically collected into the <literal>static</literal> directory in
                    <literal>/horizon/lib/</literal>.  The following is an example of how to inherit from
                    Bootswatch’s <literal>darkly</literal> theme:</para>
      <screen>@import "/horizon/lib/bootswatch/darkly/variables";
@import "/horizon/lib/bootswatch/darkly/bootswatch";</screen>
    </section>
  </section>
  <section>
    <title>Organizing Your Theme Directory</title>
    <para>A custom theme directory can be organized differently, depending on the
                level of customization that is desired, as it can include static files
                as well as Django templates.  It can include special subdirectories that will
                be used differently: <literal>static</literal>, <literal>templates</literal> and <literal>img</literal>.</para>
    <section>
      <title>The <literal>static</literal> Folder</title>
      <para>If the theme folder contains a sub-folder called <literal>static</literal>, then that sub
                    folder will be used as the <emphasis role="bold">static root of the theme</emphasis>.  I.e., Horizon will
                    look in that sub-folder for the _variables.scss and _styles.scss files.
                    The contents of this folder will also be served up at <literal>/static/custom</literal>.</para>
    </section>
    <section>
      <title>The <literal>templates</literal> Folder</title>
      <para>If the theme folder contains a sub-folder <literal>templates</literal>, then the path
                    to that sub-folder will be prepended to the <literal>TEMPLATE_DIRS</literal> tuple to
                    allow for theme specific template customizations.</para>
    </section>
    <section>
      <title>Using the <literal>templates</literal> Folder</title>
      <para>Any Django template that is used in Horizon can be overridden through a theme.
                    This allows highly customized user experiences to exist within the scope of
                    different themes.  Any template that is overridden must adhere to the same
                    directory structure that the extending template expects.</para>
      <para>For example, if you wish to customize the sidebar, Horizon expects the template
                    to live at <literal>horizon/_sidebar.html</literal>.  You would need to duplicate that
                    directory structure under your templates directory, such that your override
                    would live at <literal>{ theme_path }/templates/horizon/_sidebar.html</literal>.</para>
    </section>
    <section>
      <title>The <literal>img</literal> Folder</title>
      <para>If the static root of the theme folder contains an <literal>img</literal> directory,
                    then all images that make use of the {% themable_asset %} templatetag
                    can be overridden.</para>
      <para>These assets include logo.svg, splash-logo.svg and favicon.ico, however
                    overriding the SVG/GIF assets used by Heat within the <literal>dashboard/img</literal> folder
                    is not currently supported.</para>
    </section>
  </section>
  <section>
    <title>Customizing the Logo</title>
    <section>
      <title>Simple</title>
      <para>If you wish to customize the logo that is used on the splash screen or in the
                    top navigation bar, then you need to create an <literal>img</literal> directory under your
                    theme’s static root directory and place your custom <literal>logo.svg</literal> or
                    <literal>logo-splash.svg</literal> within it.</para>
      <para>If you wish to override the <literal>logo.svg</literal> using the previous method, and if the
                    image used is larger than the height of the top navigation, then the image will
                    be constrained to fit within the height of nav.  You can customize the height
                    of the top navigation bar by customizing the SCSS variable: <literal>$navbar-height</literal>.
                    If the image’s height is smaller than the navbar height, then the image
                    will retain its original resolution and size, and simply be centered
                    vertically in the available space.</para>
      <para>Prior to the Kilo release the images files inside of Horizon needed to be
                    replaced by your images files or the Horizon stylesheets needed to be altered
                    to point to the location of your image.</para>
    </section>
    <section>
      <title>Advanced</title>
      <para>If you need to do more to customize the logo than simply replacing the existing
                    PNG, then you can also override the _brand.html through a custom theme.  To use
                    this technique, simply add a <literal>templates/header/_brand.html</literal> to the root of
                    your custom theme, and add markup directly to the file.  For an example of how
                    to do this, see
                    <literal>openstack_dashboard/themes/material/templates/header/_brand.html</literal>.</para>
      <para>The splash / login panel can also be customized by adding
                    <literal>templates/auth/_splash.html</literal>.  See
                    <literal>openstack_dashboard/themes/material/templates/auth/_splash.html</literal> for an
                    example.</para>
    </section>
  </section>
</section>
