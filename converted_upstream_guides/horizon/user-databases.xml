<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>Create and manage databases</title>
  <para>The Database service provides scalable and reliable cloud provisioning
            functionality for both relational and non-relational database engines.
            Users can quickly and easily use database features without the burden of
            handling complex administrative tasks.</para>
  <section>
    <title>Create a database instance</title>
    <para><emphasis role="bold">Prerequisites.</emphasis> Before you create a database instance, you need to
                configure a default datastore and make sure you have an appropriate
                flavor for the type of database instance you want.</para>
    <procedure>
      <step>
        <para>
          <emphasis role="bold">Configure a default datastore.</emphasis>
        </para>
        <para>Because the dashboard does not let you choose a specific datastore to
                        use with an instance, you need to configure a default datastore. The
                        dashboard then uses the default datastore to create the instance.</para>
        <procedure>
          <step>
            <para>Add the following line to <literal>/etc/trove/trove.conf</literal>:</para>
            <screen language="console">default_datastore = DATASTORE_NAME</screen>
            <para>Replace <literal>DATASTORE_NAME</literal> with the name that the administrative
                                user set when issuing the <command>trove-manage</command> command to create the
                                datastore. You can use the trove <command>datastore-list</command> command to
                                display the datastores that are available in your environment.</para>
            <para>For example, if your MySQL data store name is set to <literal>mysql</literal>,
                                your entry would look like this:</para>
            <screen language="console">default_datastore = mysql</screen>
          </step>
          <step>
            <para>Restart Database services on the controller node:</para>
            <screen language="console"># service trove-api restart
# service trove-taskmanager restart
# service trove-conductor restart</screen>
          </step>
        </procedure>
      </step>
      <step>
        <para>
          <emphasis role="bold">Verify flavor.</emphasis>
        </para>
        <para>Make sure an appropriate flavor exists for the type of
                        database instance you want.</para>
      </step>
    </procedure>
    <para><emphasis role="bold">Create database instance.</emphasis> Once you have configured a default
                datastore and verified that you have an appropriate flavor, you can
                create a database instance.</para>
    <procedure>
      <step>
        <para>Log in to the dashboard.</para>
      </step>
      <step>
        <para>From the CURRENT PROJECT on the <guilabel>Project</guilabel> tab, select the
                        appropriate project.</para>
      </step>
      <step>
        <para>On the <guilabel>Project</guilabel> tab, open the <guilabel>Database</guilabel> tab and
                        click <guilabel>Instances</guilabel> category.  This lists the instances that
                        already exist in your environment.</para>
      </step>
      <step>
        <para>Click <guilabel>Launch Instance</guilabel>.</para>
      </step>
      <step>
        <para>In the <guilabel>Launch Database</guilabel> dialog box, specify the following values.</para>
        <para>Details</para>
        <para><guilabel>Database Name</guilabel>: Specify a name for the database instance.</para>
        <para><guilabel>Flavor</guilabel>: Select an appropriate flavor for the instance.</para>
        <para><guilabel>Volume Size</guilabel>: Select a volume size. Volume size is expressed in
                        GB.</para>
        <para><guilabel>Initialize Databases</guilabel>: Initial Database</para>
        <para>Optionally provide a comma separated list of databases to create, for
                        example:</para>
        <para><literal>database1</literal>, <literal>database2</literal>, <literal>database3</literal></para>
        <para><guilabel>Initial Admin User</guilabel>: Create an initial admin user. This user will
                        have access to all the databases you create.</para>
        <para><guilabel>Password</guilabel>: Specify a password associated with the initial admin
                        user you just named.</para>
        <para><guilabel>Host</guilabel>: Optionally, allow the user to connect only from this host.
                        If you do not specify a host, this user will be allowed to connect from
                        anywhere.</para>
      </step>
      <step>
        <para>Click the <guilabel>Launch</guilabel> button. The new database instance appears in
                        the databases list.</para>
      </step>
    </procedure>
  </section>
  <section>
    <title>Backup and restore a database</title>
    <para>You can use Database services to backup a database and store the backup
                artifact in the Object Storage service. Later on, if the original
                database is damaged, you can use the backup artifact to restore the
                database. The restore process creates a database instance.</para>
    <para>This example shows you how to back up and restore a MySQL database.</para>
    <section>
      <title>To backup the database instance</title>
      <procedure>
        <step>
          <para>Log in to the dashboard.</para>
        </step>
        <step>
          <para>From the CURRENT PROJECT on the <guilabel>Project</guilabel> tab, select the
                            appropriate project.</para>
        </step>
        <step>
          <para>On the <guilabel>Project</guilabel> tab, open the <guilabel>Database</guilabel> tab and
                            click <guilabel>Instances</guilabel> category. This displays the existing
                            instances in your system.</para>
        </step>
        <step>
          <para>Click <guilabel>Create Backup</guilabel>.</para>
        </step>
        <step>
          <para>In the <guilabel>Backup Database</guilabel> dialog box, specify the following
                            values:</para>
          <para>Name</para>
          <para>Specify a name for the backup.</para>
          <para>Database Instance</para>
          <para>Select the instance you want to back up.</para>
        </step>
        <step>
          <para>Click <guilabel>Backup</guilabel>. The new backup appears in the backup list.</para>
        </step>
      </procedure>
    </section>
    <section>
      <title>To restore a database instance</title>
      <para>Now assume that your original database instance is damaged and you
                    need to restore it. You do the restore by using your backup to create
                    a new database instance.</para>
      <procedure>
        <step>
          <para>Log in to the dashboard.</para>
        </step>
        <step>
          <para>From the CURRENT PROJECT on the <guilabel>Project</guilabel> tab, select the
                            appropriate project.</para>
        </step>
        <step>
          <para>On the <guilabel>Project</guilabel> tab, open the <guilabel>Database</guilabel> tab and
                            click <guilabel>Backups</guilabel> category. This lists the available backups.</para>
        </step>
        <step>
          <para>Check the backup you want to use and click <guilabel>Restore Backup</guilabel>.</para>
        </step>
        <step>
          <para>In the <guilabel>Launch Database</guilabel> dialog box, specify the values you
                            want for the new database instance.</para>
        </step>
        <step>
          <para>Click the <guilabel>Restore From Database</guilabel> tab and make sure that this
                            new instance is based on the correct backup.</para>
        </step>
        <step>
          <para>Click <guilabel>Launch</guilabel>.</para>
          <para>The new instance appears in the database instances list.</para>
        </step>
      </procedure>
    </section>
  </section>
  <section>
    <title>Update a database instance</title>
    <para>You can change various characteristics of a database instance,
                such as its volume size and flavor.</para>
    <section>
      <title>To change the volume size of an instance</title>
      <procedure>
        <step>
          <para>Log in to the dashboard.</para>
        </step>
        <step>
          <para>From the CURRENT PROJECT on the <guilabel>Project</guilabel> tab, select the
                            appropriate project.</para>
        </step>
        <step>
          <para>On the <guilabel>Project</guilabel> tab, open the <guilabel>Database</guilabel> tab and
                            click <guilabel>Instances</guilabel> category. This displays the existing
                            instances in your system.</para>
        </step>
        <step>
          <para>Check the instance you want to work with.
                            In the <guilabel>Actions</guilabel> column, expand the drop down menu
                            and select <guilabel>Resize Volume</guilabel>.</para>
        </step>
        <step>
          <para>In the <guilabel>Resize Database Volume</guilabel> dialog box,
                            fill in the <guilabel>New Size</guilabel> field with an integer indicating
                            the new size you want for the instance. Express the size in GB, and
                            note that the new size must be larger than the current size.</para>
        </step>
        <step>
          <para>Click <guilabel>Resize Database Volume</guilabel>.</para>
        </step>
      </procedure>
    </section>
    <section>
      <title>To change the flavor of an instance</title>
      <procedure>
        <step>
          <para>Log in to the dashboard.</para>
        </step>
        <step>
          <para>From the CURRENT PROJECT on the <guilabel>Project</guilabel> tab, select the
                            appropriate project.</para>
        </step>
        <step>
          <para>On the <guilabel>Project</guilabel> tab, open the <guilabel>Database</guilabel> tab and
                            click <guilabel>Instances</guilabel> category. This displays the existing
                            instances in your system.</para>
        </step>
        <step>
          <para>Check the instance you want to work with. In the
                            <guilabel>Actions</guilabel> column, expand the drop down menu and
                            select <guilabel>Resize Instance</guilabel>.</para>
        </step>
        <step>
          <para>In the <guilabel>Resize Database Instance</guilabel> dialog box,
                            expand the drop down menu in the <guilabel>New Flavor</guilabel> field.
                            Select the new flavor you want for the instance.</para>
        </step>
        <step>
          <para>Click <guilabel>Resize Database Instance</guilabel>.</para>
        </step>
      </procedure>
    </section>
  </section>
</section>
