<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
  <title>Horizon Middleware</title>
  <section>
    <title>HorizonMiddleware</title>
    <variablelist>
      <varlistentry xml:id="horizon.middleware.HorizonMiddleware">
        <term>
          <literal>horizon.middleware.HorizonMiddleware</literal>
        </term>
        <listitem>
          <para>The main Horizon middleware class. Required for use of Horizon.</para>
          <variablelist>
            <varlistentry xml:id="horizon.middleware.HorizonMiddleware.process_exception">
              <term>
                <property>horizon.middleware.HorizonMiddleware.process_exception</property>
              </term>
              <listitem>
                <para>Catches internal Horizon exception classes.</para>
                <para>Exception classes such as NotAuthorized, NotFound and Http302
                                are caught and handles them gracefully.</para>
              </listitem>
            </varlistentry>
          </variablelist>
          <variablelist>
            <varlistentry xml:id="horizon.middleware.HorizonMiddleware.process_request">
              <term>
                <property>horizon.middleware.HorizonMiddleware.process_request</property>
              </term>
              <listitem>
                <para>Adds data necessary for Horizon to function to the request.</para>
              </listitem>
            </varlistentry>
          </variablelist>
          <variablelist>
            <varlistentry xml:id="horizon.middleware.HorizonMiddleware.process_response">
              <term>
                <property>horizon.middleware.HorizonMiddleware.process_response</property>
              </term>
              <listitem>
                <para>Convert HttpResponseRedirect to HttpResponse if request is via ajax.</para>
                <para>This is to allow ajax request to redirect url.</para>
              </listitem>
            </varlistentry>
          </variablelist>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>
  <section>
    <title>OperationLogMiddleware</title>
    <variablelist>
      <varlistentry xml:id="horizon.middleware.OperationLogMiddleware">
        <term>
          <literal>horizon.middleware.OperationLogMiddleware</literal>
        </term>
        <listitem>
          <para>Middleware to output operation log.</para>
          <para>This log can includes information below:</para>
          <itemizedlist>
            <listitem>
              <para>
                <literal>domain name</literal>
              </para>
            </listitem>
            <listitem>
              <para>
                <literal>domain id</literal>
              </para>
            </listitem>
            <listitem>
              <para>
                <literal>project name</literal>
              </para>
            </listitem>
            <listitem>
              <para>
                <literal>project id</literal>
              </para>
            </listitem>
            <listitem>
              <para>
                <literal>user name</literal>
              </para>
            </listitem>
            <listitem>
              <para>
                <literal>user id</literal>
              </para>
            </listitem>
            <listitem>
              <para>
                <literal>request scheme</literal>
              </para>
            </listitem>
            <listitem>
              <para>
                <literal>referer url</literal>
              </para>
            </listitem>
            <listitem>
              <para>
                <literal>request url</literal>
              </para>
            </listitem>
            <listitem>
              <para>
                <literal>message</literal>
              </para>
            </listitem>
            <listitem>
              <para>
                <literal>method</literal>
              </para>
            </listitem>
            <listitem>
              <para>
                <literal>http status</literal>
              </para>
            </listitem>
            <listitem>
              <para>
                <literal>request parameters</literal>
              </para>
            </listitem>
          </itemizedlist>
          <para>and log format is defined OPERATION_LOG_OPTIONS.</para>
          <variablelist>
            <varlistentry xml:id="horizon.middleware.OperationLogMiddleware.process_exception">
              <term>
                <property>horizon.middleware.OperationLogMiddleware.process_exception</property>
              </term>
              <listitem>
                <para>Log error info when exception occurred.</para>
              </listitem>
            </varlistentry>
          </variablelist>
          <variablelist>
            <varlistentry xml:id="horizon.middleware.OperationLogMiddleware.process_response">
              <term>
                <property>horizon.middleware.OperationLogMiddleware.process_response</property>
              </term>
              <listitem>
                <para>Log user operation.</para>
              </listitem>
            </varlistentry>
          </variablelist>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>
</section>
